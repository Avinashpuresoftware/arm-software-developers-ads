{{define "main"}}

<!-- Hugo variable setting -->
{{ $current_title := .Page.Title}}
{{ $path_front    := path.Dir (trim .Page.RelPermalink "/") }}

<div class="c-row md:is-collapsed u-gap-1-1/2 u-flex-nowrap">

    <!-- Category filter -->
    <div class="c-col u-hide lg:u-display-block u-flex-shrink-0 u-margin-top-2" style="width: 320px;">
        <div class="u-display-grid u-gap-1/2 lg:u-grid-columns-2">

            <!-- Make range of just learning path pages 'cloud' 'iot' etc. -->
            {{ range where .Site.Pages "Params.maintopic" true}}
                {{ partial "ads-cards/main-topic-buttons.html" (dict "context" . "current_title" $current_title "link_to" .Permalink )}}
            {{end}}
        </div>

    </div>
    
    <!-- Top level context for this learning path-->
    <div class="c-col c-col-12">
        <header><h2>{{.Params.subtitle}}</h2></header>
        <div class="c-row">
            <div class="c-col c-col-12">
                <div class="u-display-grid u-gap-1 lg:u-grid-columns-1 xl:u-grid-columns-2 xxl:u-grid-columns-3 xxxl:u-grid-columns-4 u-margin-top-1">
                    {{range .Params.pinned_modules}}
                        {{ with .module }}
                            <ads-card class='module-card'>
                                <ads-card-content slot="content">
                                    <h6 class="module-card-title u-text-bold u-margin-top-0 u-margin-bottom-0">{{.name}}</h6>
                                    <p class="module-card-subtitle u-margin-top-0 u-margin-bottom-1/2">{{.subtitle}}</p>
                                    <ul>
                                        {{ range .paths}}
                                            {{$this_path_link := printf "%s%s" $.Page.RelPermalink .}}
                                            {{$this_path_index_link := printf "%s/%s" . "_index.md"}}
                                                <li class="module-card-title-path-name u-margin-left-1 u-margin-top-0 u-margin-bottom-0">
                                                    <a class="module-card-a" href="{{$this_path_link }}">
                                                        {{ with $.GetPage $this_path_index_link }}{{ .Title }}{{ end }}
                                                    </a>
                                                </li>
                                                
                                        {{end}}
                                    </ul>
                                </ads-card-content>   
                            </ads-card>  
                        {{end}}
                    {{end}}
                </div>
            </div>
        </div>
    </div>
</div>


    <div class="c-row md:is-collapsed u-gap-1-1/2 u-flex-nowrap u-padding-top-3 u-padding-bottom-2-1/2">
        <!-- Filter bar on left -->
        <div class="c-col u-hide lg:u-display-block u-flex-shrink-0" style="max-width: 320px;">
    
            <!-- Subjects, CLOSED SCHEMA -->
            {{ partial "filtering/closed-expansion.html" (dict "context" . "displayname" "Subjects" "routing" "subjects" "tagnames" .Params.subjects_closed_schema)}} 
            <!-- Operating Systems, CLOSED SCHEMA -->
            {{ partial "filtering/closed-expansion.html" (dict "context" . "displayname" "OS" "routing" "operatingsystems" "tagnames" .Params.oses_closed_schema)}} 
            <!-- Skill level, CLOSED SCHEMA -->
            {{ partial "filtering/closed-expansion.html" (dict "context" . "displayname" "Skill Level" "routing" "skilllevels" "tagnames" (slice "Getting Started" "Introductory" "Experienced"))}}
            <!-- Software -->
            {{ partial "filtering/open-expansion.html" (dict "context" . "displayname" "Software")}}
            <!-- Tools -->
            {{ partial "filtering/open-expansion.html" (dict "context" . "displayname" "Tools")}}
        </div>

    <!-- Search & Results on Right -->
    <div class="c-col">

        <!-- Search bar (and hidden filters on mobile)-->
        <div class="c-row u-flex">
            <ads-search id="search-box" class="u-width-100%"></ads-search>
        </div>

        <ads-button level="tertiary" size="default" class="lg:u-hide u-position-relative">
            <i class="fal fa-filter"></i>
        </ads-button>

        <!-- Current tag bar -->
        <div id="current-tag-bar" class="c-row u-margin-top-1/2" style="min-height: 30px;">
            <!-- Filled dynamically by javascript & checkboxes-->
        </div>

        <!-- List of learning paths on right -->
        <div class="c-row">
            <div class="c-col c-col-12">
                <div class="u-display-grid u-gap-1 lg:u-grid-columns-1 xl:u-grid-columns-2 xxl:u-grid-columns-3 xxxl:u-grid-columns-4 u-margin-top-1">
                    {{ range .Pages.ByLastmod.Reverse }}
                    <!-- This div does two things, iterating over each tag in the taxonomy:
                        1) Assign tags for filtering the learning path cards 
                        2) Keeps track of unique tags to generate the filter column  -->
                    <div class='path-div search-div
                                {{ with .Params.skillLevels }}
                                    tag-{{. | urlize}}
                                {{ end }}
                                {{ with .Params.armips }}
                                    {{range .}}
                                        tag-{{. | urlize}}
                                    {{end}}
                                {{ end }}
                                {{ with .Params.tools }}
                                    {{ range .}}
                                        tag-{{. | urlize}}
                                    {{end}}
                                {{ end }}
                                {{ with .Params.softwares }}
                                    {{ range .}}
                                        tag-{{. | urlize}}
                                    {{end}}
                                {{ end }}
                                {{ with .Params.operatingsystems }}
                                    {{ range .}}
                                        tag-{{. | urlize}}
                                    {{ end }}
                                {{ end }}
                                {{ with .Params.developerprograms }}
                                    {{ range .}}
                                        tag-{{. | urlize}}
                                    {{ end }}
                                {{ end }}
                                {{ with .Params.subjects }}
                                    {{ range .}}
                                        tag-{{. | urlize}}
                                    {{ end }}
                                {{ end }}'>
                        <ads-card has-hover-effect  link="{{.Permalink}}" class='path-card'>
                            <ads-card-content slot="content">
                                <ads-tag class="path-card-tag {{.Params.skillLevels}}" text="{{.Params.skillLevels}}"></ads-tag>
                                <h4 class="search-title card-title u-margin-top-1/2 u-margin-bottom-1/2">{{.Title}}</h4>
                                <p class="card-date">Updated: {{ .Lastmod.UTC.Format "January 2, 2006" }}</p>
                                <p class="card-description">{{.Description}}</p>
                            </ads-card-content>   
                        </ads-card>
                    </div>           
                    {{ end }}
                </div>
            </div>
        </div>

    </div>


</div> <!-- End of left-right divide -->

{{ partial "filtering/filter-tag.html" . }}
{{ partial "ads-cards/ads-card-style.html" . }}

<!-- Include javascript to filter and search -->
<script src="/js/search-and-filter/filter-learning-paths.js"></script>
<script src="/js/search-and-filter/search-logic.js"></script>
<script src="/js/search-and-filter/search-handling.js"></script>







<script>
    (() => {
        // Assign inputChangeHandler to search box
        const search_box = document.getElementById('search-box');
        search_box.inputChangeHandler = searchHandler_LearningPaths;

        // Handle search term from URL
        let url_str = window.location.search;
        if (url_str.includes('search=')) {
            let search_string = parseParamsFromURL(url_str);

            // Call search handler to execute
            search_box.setAttribute('search-value',search_string);
            searchHandler_LearningPaths(search_string);
        }
    })();
</script>

{{end}}